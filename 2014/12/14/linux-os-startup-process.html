<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Linux：系统启动引导过程 | Zhao Dedong's Blog</title><link rel="stylesheet" type="text/css" href="/css/normalize.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/pure-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Linux：系统启动引导过程</h1><a id="logo" href="/.">Zhao Dedong's Blog</a><p class="description">Try Harder ！</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Linux：系统启动引导过程</h1><div class="post-meta">Dec 14, 2014<span> | </span><span class="category"><a href="/categories/linux/">linux</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2014/12/14/linux-os-startup-process.html" href="/2014/12/14/linux-os-startup-process.html#comments" class="ds-thread-count"></a><div class="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近发现自己在只是掌握上有几个比较硬的伤：</p>
<ul>
<li><p>一、知识体系碎片，比如Linux，这学点那学点，结果没有成体系，串不起来；</p>
</li>
<li><p>二、记忆时间短暂，很多的内容学了就忘，最后的结果是遇见一个知识点就能想起来自己的确学过，但是现在记不起来了。</p>
</li>
<li><p>三、理解程度浅显，比如说今天要整理关于Linux引导的内容，之前大体是知道的，不能称之为理解，我认为在学着一个知识点的时候至少要能系统有条理地讲出来，而不是有个模模糊糊的大体认识。</p>
</li>
</ul>
<h2 id="个别名词解释"><a href="#个别名词解释" class="headerlink" title="个别名词解释"></a>个别名词解释</h2><p>1.<strong>BIOS</strong>（Basic Input Output System）：基本输入输出系统。其实，它是一组固化到计算机内主板上一个ROM芯片上的程序，它保存着计算机最重要的基本输入输出的程序、开机后自检程序和系统自启动程序，它可从CMOS中读写系统设置的具体信息。</p>
<p>2.<strong>MBR</strong>（Master Boot Record)：主引导记录。硬盘的0柱面、0磁头、1扇区称为主引导扇区（也叫主引导记录MBR）。</p>
<p>MBR是不属于任何一个操作系统，也不能用操作系统提供的磁盘操作命令来读取它，但可以通过命令来修改和重写。</p>
<p>3.<strong>GRUB</strong>（GRand Unified Bootloader）：GNU GRUB是一个来自GNU项目的多操作系统启动程序。GRUB是多启动规范的实现，它允许用户可以在计算机内同时拥有多个操作系统，并在计算机启动时选择希望运行的操作系统。GRUB可用于选择操作系统分区上的不同内核，也可用于向这些内核传递启动参数。</p>
<h2 id="详细分析引导过程"><a href="#详细分析引导过程" class="headerlink" title="详细分析引导过程"></a>详细分析引导过程</h2><h3 id="第一步、加载BIOS"><a href="#第一步、加载BIOS" class="headerlink" title="第一步、加载BIOS"></a>第一步、加载BIOS</h3><p>BIOS的功能由两部分组成，分别是POST码和Runtime服务。POST阶段完成后它将从存储器中被清除，而Runtime服务会被一直保留，用于目标操作系统的启动。BIOS两个阶段所做的详细工作如下：</p>
<ol>
<li><p>步骤1：上电自检POST(Power-on self test)，主要负责检测系统外围关键设备（如：CPU、内存、显卡、I/O、键盘鼠标等）是否正常。例如，最常见的是内存松动的情况，BIOS自检阶段会报错，系统就无法启动起来；</p>
</li>
<li><p>步骤2：步骤1成功后，便会执行一段小程序用来枚举本地设备并对其初始化。这一步主要是根据我们在BIOS中设置的系统启动顺序来搜索用于启动系统的驱动器，如硬盘、光盘、U盘、软盘和网络等。我们以硬盘启动为例，BIOS此时去读取硬盘驱动器的第一个扇区(MBR，512字节)，然后执行里面的代码。实际上这里BIOS并不关心启动设备第一个扇区中是什么内容，它只是负责读取该扇区内容、并执行。<br>至此，BIOS的任务就完成了，此后将系统启动的控制权移交到MBR部分的代码。</p>
</li>
</ol>
<h3 id="第二步、读取MBR"><a href="#第二步、读取MBR" class="headerlink" title="第二步、读取MBR"></a>第二步、读取MBR</h3><p>系统找到BIOS所指定的硬盘的MBR后，就会将其复制到0×7c00地址所在的物理内存中。其实被复制到物理内存的内容就是Boot Loader，而具体到你的电脑，那就是lilo或者grub了。</p>
<h4 id="补充："><a href="#补充：" class="headerlink" title="补充："></a>补充：</h4><p>一个扇区的硬盘主引导记录MBR由4个部分组成。</p>
<ol>
<li><p>主引导程序（偏移地址0000H–0088H），它负责从活动分区中装载，并运行系统引导程序。</p>
</li>
<li><p>出错信息数据区，偏移地址0089H–00E1H为出错信息，00E2H–01BDH全为0字节。</p>
</li>
<li><p>分区表（DPT,Disk Partition Table）含4个分区项，偏移地址01BEH–01FDH,每个分区表项长16个字节，共64字节为分区项1、分区项2、分区项3、分区项4。</p>
</li>
<li><p>结束标志字，偏移地址01FE–01FF的2个字节值为结束标志0xAA55或0x55AA,称为“魔数”（magic number）。如果该标志错误系统就不能启动。</p>
</li>
</ol>
<h3 id="第三步、Boot-Loader"><a href="#第三步、Boot-Loader" class="headerlink" title="第三步、Boot Loader"></a>第三步、Boot Loader</h3><p>Boot Loader 就是在操作系统内核运行之前运行的一段小程序。通过这段小程序，我们可以初始化硬件设备、建立内存空间的映射图，从而将系统的软硬件环境带到一个合适的状态，以便为最终调用操作系统内核做好一切准备。Boot Loader有若干种，其中Grub、Lilo是常见的Loader。系统读取内存中的grub配置信息（一般为menu.lst或grub.lst），并依照此配置信息来启动不同的操作系统。</p>
<h3 id="第四步、加载内核"><a href="#第四步、加载内核" class="headerlink" title="第四步、加载内核"></a>第四步、加载内核</h3><p>根据grub设定的内核映像所在路径，系统读取内存映像，并进行解压缩操作。此时，屏幕一般会输出“Uncompressing Linux”的提示。当解压缩内核完成后，屏幕输出“OK, booting the kernel”。</p>
<p>系统将解压后的内核放置在内存之中，并调用start_kernel()函数来启动一系列的初始化函数并初始化各种设备，完成Linux核心环境的建立。至此，Linux内核已经建立起来，基于Linux的程序应该可以正常运行。</p>
<h3 id="第五步、用户层init依据inittab文件来设定运行等级"><a href="#第五步、用户层init依据inittab文件来设定运行等级" class="headerlink" title="第五步、用户层init依据inittab文件来设定运行等级"></a>第五步、用户层init依据inittab文件来设定运行等级</h3><p>内核被加载后，第一个运行的程序便是/sbin/init，该文件会读取/etc/inittab文件，并依据此文件来进行初始化工作。</p>
<p>/etc/inittab文件最主要的作用就是设定Linux的运行等级，其设定形式是“：id:5:initdefault:”，这就表明Linux需要运行在等级5上。Linux的运行等级设定如下：</p>
<ul>
<li>0：关机</li>
<li>1：单用户模式</li>
<li>2：无网络支持的多用户模式</li>
<li>3：有网络支持的多用户模式</li>
<li>4：保留，未使用</li>
<li>5：有网络支持有X-Window支持的多用户模式</li>
<li>6：重新引导系统，即重启</li>
</ul>
<h3 id="第六步、init进程执行rc-sysinit"><a href="#第六步、init进程执行rc-sysinit" class="headerlink" title="第六步、init进程执行rc.sysinit"></a>第六步、init进程执行rc.sysinit</h3><p>在设定了运行等级后，Linux系统执行的第一个用户层文件就是/etc/rc.d/rc.sysinit脚本程序，它设定PATH、设定网络配置（/etc/sysconfig/network）、启动swap分区、设定/proc等等。</p>
<h3 id="第七步、启动内核模块"><a href="#第七步、启动内核模块" class="headerlink" title="第七步、启动内核模块"></a>第七步、启动内核模块</h3><p>具体是依据/etc/modules.conf文件或/etc/modules.d目录下的文件来装载内核模块。</p>
<h3 id="第八步、执行不同运行级别的脚本程序"><a href="#第八步、执行不同运行级别的脚本程序" class="headerlink" title="第八步、执行不同运行级别的脚本程序"></a>第八步、执行不同运行级别的脚本程序</h3><p>根据运行级别的不同，系统会运行rc0.d到rc6.d中的相应的脚本程序，来完成相应的初始化工作和启动相应的服务。</p>
<h3 id="第九步、执行-etc-rc-d-rc-local"><a href="#第九步、执行-etc-rc-d-rc-local" class="headerlink" title="第九步、执行/etc/rc.d/rc.local"></a>第九步、执行/etc/rc.d/rc.local</h3><p>你如果打开了此文件，里面有一句话，读过之后，你就会对此命令的作用一目了然：</p>
<blockquote>
<p>This script will be executed <em>after</em> all the other init scripts.</p>
<p>You can put your own initialization stuff in here if you don’t.</p>
<p>want to do the full Sys V style init stuff.</p>
</blockquote>
<p>rc.local就是在一切初始化工作后，Linux留给用户进行个性化的地方。你可以把你想设置和启动的东西放到这里。</p>
<h3 id="第十步、执行-bin-login程序，进入登录状态"><a href="#第十步、执行-bin-login程序，进入登录状态" class="headerlink" title="第十步、执行/bin/login程序，进入登录状态"></a>第十步、执行/bin/login程序，进入登录状态</h3><p>此时，系统已经进入等待用户输入username和password状态，用户可以用自己的帐号登入系统 </p>
</div><a data-url="zhaodedong.github.io/2014/12/14/linux-os-startup-process.html" data-id="cilkeuxv50010e4w5wgum4xoc" class="article-share-link">分享到</a><div class="tags"></div><div class="post-nav"><a href="/2014/12/19/shell-cut.html" class="pre">Shell：cut命令</a><a href="/2014/12/12/the-data-revolution-speaker.html" class="next">The Data Revolution Speaker（Hadoop之父Doug Cutting在清华的讲座）</a></div><div data-thread-key="2014/12/14/linux-os-startup-process.html" data-title="Linux：系统启动引导过程" data-url="zhaodedong.github.io/2014/12/14/linux-os-startup-process.html" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2014/12/14/linux-os-startup-process.html" data-title="Linux：系统启动引导过程" data-url="zhaodedong.github.io/2014/12/14/linux-os-startup-process.html" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="zhaodedong.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/meeting/">meeting</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/disk/" style="font-size: 15px;">disk</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/string/" style="font-size: 15px;">string</a> <a href="/tags/tools/" style="font-size: 15px;">tools</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/cluster/" style="font-size: 15px;">cluster</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/vm/" style="font-size: 15px;">vm</a> <a href="/tags/i/" style="font-size: 15px;">i++</a> <a href="/tags/ext/" style="font-size: 15px;">ext</a> <a href="/tags/filesystem/" style="font-size: 15px;">filesystem</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/cpu/" style="font-size: 15px;">cpu</a> <a href="/tags/grep/" style="font-size: 15px;">grep</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/mechanize/" style="font-size: 15px;">mechanize</a> <a href="/tags/bigdata/" style="font-size: 15px;">bigdata</a> <a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/01/01/mysql-error-process.html">Mysql：一次mysql错误处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/06/java-string-buffer-builder.html">Java：String、StringBuffer和StringBuilder</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/04/java-vm-orders.html">Java：虚拟机指令总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/04/java-i-plusplus.html">Java：i++问题（详细分析）</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/01/java-tools.html">Java工具：javac、javap、jmap、jhat、jstack、jstat</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/14/linux-partition-fdisk-parted.html">Linux：磁盘分区和挂载（parted和fdisk两种方式详细说明）</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/11/java-passing-primitives.html">Java：详解传值和传引用</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/11/linux-command-summary.html">Linux：常用命令总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/10/docker-deploy-development-environment.html">Docker：搭建开发环境（运行Eclipse等图形化界面程序）</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/06/19/docker-attempt.html">Docker：初步使用</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Zhao Dedong's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/jquery.min.js?v=0.0.0"></script><script type="text/javascript" src="/js/totop.js?v=0.0.0"></script><script type="text/javascript" src="/js/fancybox.pack.js?v=0.0.0"></script><script type="text/javascript" src="/js/jquery.fancybox.js?v=0.0.0"></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'grass'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/share.js?v=0.0.0"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>