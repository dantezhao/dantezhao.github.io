---
layout: post
author: zhao
title:  "Linux：磁盘结构"
date:   2014-08-13 22:14:54
categories: Linux
---

* content
{:toc}


##磁盘相关名词解释

###磁头（Header）

硬盘的存储原理是将数据用起控制电路通过硬盘读写头求改变磁盘表面上极细微的磁性粒子簇N、S极性来加以存储，所以这几篇磁盘相当重要。

###步进电机

为了让磁头精确定位到每个磁道，用普通的电机达不到这样的精度，必须使用步进电机，利用精确的齿轮组或者音圈，每次旋转可以仅仅使磁头进行微米级的位移。

###**盘片**

先说明一下硬盘、盘片和盘面的关系：

- 硬盘：盘片 = 1：N
- 盘片：盘面 = 1：2

也就是一块硬盘可以有多个盘片，每个盘片有上下两个盘面。

盘片的基板由金属或玻璃材质制作，为达到高密度、高稳定性的要求，基板要求表面光滑平整，不可有任何瑕疵。

每个盘片的每个面都有一个读写磁头，磁头起初停在盘片的最内圈，即线性速度最小的地方。这是一个特殊的区域，它不存放任何数据，称为**启停区**或着陆区（Landing Zone）。启停区外就是数据区。在最外圈，离株洲最远的地方是0磁道，硬盘数据的存放就是从最外圈开始的。

###**盘面**

硬盘中的每个盘面都能利用，都可以存放数据成为有效盘面。每一个盘面都有一个盘面号，从上到下的顺序从0开始编号。在硬盘系统中，盘面号幼教磁头号，因为每一个有效盘面都有一个对应的读写磁头。

硬盘的盘片组在2~14片不等，通常有2~3个盘片。

###**磁道**

磁盘在格式化的时候被划分成许多同心圆，这些同心圆轨迹叫做磁道。磁道从最外圈向内圈开始顺序编号。每个盘面有300~1024个磁道。

磁道是肉眼看不到的，只是盘面上以特殊形式磁化了的一些磁化区。

###**扇区**（Sector）

将每个环形磁道等距离切割，形成等长度的圆弧，每个圆弧就是一个扇区。扇区从1开始编号，每个扇区中的数据作为一个单元同事独处或者写入，是**读写的最小单位**。

每个扇区可以存放512B的数据和一些其他信息。一个扇区有两个主要部分：存储数据地点的标识符和存储数据的数据段。

划分磁道和扇区的过程叫做**低级格式化**，通常出厂的时候已经完成。相对于低级格式化来说，**高级格式化**是指对磁盘上的数据进行文件系统的标记而不是对扇区和磁道进行标记。

![sector-track]({{ "/pics/sector-track.png"}})

###**柱面**（Cylinder）

所有盘面上的同一磁道，在垂直方向上构成一个圆柱，通常称为柱面。每个柱面上的磁头由上而下从0编号。

***数据的读写按柱面进行。***

![cylinder]({{ "/pics/cylinder.png"}})

###**0磁道**

0磁道处于硬盘上一个非常重要的位置，硬盘的主引导记录区(MBR)就在这个位置上。MBR位于硬盘的0磁头0柱面1扇区，其中存放着硬盘主引导程序和硬盘分区表。

##磁盘工作原理

###磁头工作原理

早期的硬盘在每次关机之前需要运行一个被称为Parking的程序，其作用是让磁头回到盘片最内圈的一个不含磁粒子的区域，叫做启停区。

磁盘不工作的时候，磁头停留在启停区，当需要从硬盘中读写数据的时候，磁盘就先开始旋转。旋转速度达到额定速度时，磁头就会因为盘片旋转产生的气流抬起来，这时候磁头才向盘片中存放数据的区域移动。

###数据读写原理

数据的读写按柱面进行，即磁头读写数据时首先在同一柱面内从0磁头开始进行操作，依次向下在同一柱面的不同盘片（即磁头）上进行操作。

只有在同一柱面上所有磁头全部读写完毕后磁头才转移到下一个柱面，因为选取磁头只需通过电子切换即可，而选取柱面则必须通过机械切换，即**寻道**。

电子切换相当快，比使用机械将磁头向临济磁道移动要快得多，所以数据的读写按柱面进行，而不按盘面进行。

![partition]({{ "/pics/partition.png"}})

##补充

###基于CHS编址方式的磁盘最大容量计算

- **CHS**：Cylinder、Header、Sector
- **磁头数**：（8个二进制位存储）：最大255
- **柱面数**：（10个二进制位存储）：最大1023
- **扇区数**：（6个二进制位存储）：最大63
- **扇区大小**：每个扇区一般512B

` 容量=磁头数*柱面数*扇区数*扇区大小=255*1023*63*512/1048576=8024MB`

这就是所谓的8GB容量限制的原因。

###影响磁盘性能的因素

1. 转速
2. 寻道速度
3. 单碟容量
4. 接口速度

注意一点：**磁盘每个时刻只允许一个磁头来读写数据**。也就是说，不管 盘体内盘片和磁头再多 ，也不可能提高硬盘的吞吐量和IO性能，只能提高容量。



