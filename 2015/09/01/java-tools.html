<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Java工具：javac、javap、jmap、jhat、jstack、jstat | Zhao Dedong's Blog</title><link rel="stylesheet" type="text/css" href="http:/zhaodedong.github.io/css/normalize.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="http:/zhaodedong.github.io/css/pure-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="http:/zhaodedong.github.io/css/grids-responsive-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="http:/zhaodedong.github.io/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="http:/zhaodedong.github.io/favicon.ico"><link rel="apple-touch-icon" href="http:/zhaodedong.github.io/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="http:/zhaodedong.github.io/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Java工具：javac、javap、jmap、jhat、jstack、jstat</h1><a id="logo" href="http:/zhaodedong.github.io/.">Zhao Dedong's Blog</a><p class="description">Try Harder ！</p></div><div id="nav-menu"><a href="http:/zhaodedong.github.io/." class="current"><i class="fa fa-home"> 首页</i></a><a href="http:/zhaodedong.github.io/archives/"><i class="fa fa-archive"> 归档</i></a><a href="http:/zhaodedong.github.io/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Java工具：javac、javap、jmap、jhat、jstack、jstat</h1><div class="post-meta">Sep 1, 2015<span> | </span><span class="category"><a href="http:/zhaodedong.github.io/categories/java/">java</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2015/09/01/java-tools.html" href="http:/zhaodedong.github.io/2015/09/01/java-tools.html#comments" class="ds-thread-count"></a><div class="post-content"><h1 id="javac"><a href="#javac" class="headerlink" title="javac"></a>javac</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>突然有一天发现，之前认为学到的知识其实连冰山一角都算不上。</p>
</blockquote>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>我们平常编写的Java代码需要先被编译为二进制的字节码，例如Hello.java源文件会被编译为Hello.class字节码文件，然后才能被Java虚拟机执行。</p>
<p>在此之前一般都是用Eclipse直接进行Java开发了，命令行用的非常少，基本上也就是在知道javac后面跟上<code>.java</code>文件。现在接触到了更多的Java知识，有时候需要远程调试Java程序，或者需要查看<code>.class</code>文件，发现javac这个工具有很多需要关注和学习的地方。</p>
<p><code>javac</code>在<code>$JAVA_HOME/bin</code>中，一般在安装好jdk，并配置好环境变量后就可以直接使用了。</p>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>有两种方法可将源代码文件名传递给 javac</p>
<p>如果源文件数量少，在命令行上列出文件名即可。</p>
<p>如果源文件数量多，则将源文件名列在一个文件中，名称间用空格或回车行来进行分隔。然后在 javac 命令行中使用该列表文件名，文件名前冠以 @ 字符。</p>
<p>源代码文件名称必须含有 .java 后缀，类文件名称必须含有 .class 后缀，源文件和类文件都必须有识别该类的根名。例如，名为 MyClass 的类将写在名为 HelloWorld.java的源文件中，并被编译为字节码类文件 HelloWorld.class。</p>
<p>内部类定义产生附加的类文件。这些类文件的名称将内部类和外部类的名称结合在一起，例如 HelloWorld$InnerHelloworld.class。</p>
<p>应当将源文件安排在反映其包树结构的目录树中。例如，如果将所有的源文件放在 /workspace 中，那么 com.zhao.test.HelloWorld 的代码应该在 \workspace\com\zhao\test\HelloWorld.java 中。</p>
<p>缺省情况下，编译器将每个类文件与其源文件放在同一目录中。可用 -d 选项（请参阅后面的选项）指定其它目标目录。</p>
<h2 id="常用参数"><a href="#常用参数" class="headerlink" title="常用参数"></a>常用参数</h2><p>下面介绍几个常用或者说自己会用的参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">用法: javac &lt;options&gt; &lt;source files&gt;</span><br><span class="line">其中, 可能的选项包括:</span><br><span class="line">  -g                         生成所有调试信息，-g参数在debug的时候会使用，特别是在使用Eclipse的进行debug的时候，里面的一些选项其实对应的就是-g参数。</span><br><span class="line">  -g:none                    不生成任何调试信息</span><br><span class="line">  -g:&#123;lines,vars,source&#125;     只生成某些调试信息</span><br><span class="line">  -nowarn                    不生成任何警告</span><br><span class="line">  -verbose                   输出有关编译器正在执行的操作的消息</span><br><span class="line">  -classpath &lt;路径&gt;            指定查找用户类文件和注释处理程序的位置</span><br><span class="line">  -cp &lt;路径&gt;                   指定查找用户类文件和注释处理程序的位置</span><br><span class="line">  -d &lt;目录&gt;                    指定放置生成的类文件的位置</span><br><span class="line">  -s &lt;目录&gt;                    指定放置生成的源文件的位置</span><br><span class="line">  -encoding &lt;编码&gt;             指定源文件使用的字符编码</span><br><span class="line">  -source &lt;发行版&gt;              提供与指定发行版的源兼容性</span><br><span class="line">  -target &lt;发行版&gt;              生成特定 VM 版本的类文件</span><br><span class="line">  -version                   版本信息</span><br><span class="line">  -help                      输出标准选项的提要</span><br></pre></td></tr></table></figure>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><h3 id="例1"><a href="#例1" class="headerlink" title="例1"></a>例1</h3><p>先来个大致参数用法的例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@z1 i++issue]# javac -source 1.7 -target 1.7 -d ./classdir/ -verbose -encoding UTF-8 -g:vars SumPlusTest.java </span><br><span class="line">[parsing started RegularFileObject[SumPlusTest.java]]</span><br><span class="line">[parsing completed 13ms]</span><br><span class="line">[search path for source files: .,/mnt/zhao/soft/jdk/lib/dt.jar,/mnt/zhao/soft/jdk/lib/tools.jar]</span><br><span class="line">[search path for class files: /mnt/zhao/soft/jdk/jre/lib/resources.jar,/mnt/zhao/soft/jdk/jre/lib/rt.jar,/mnt/zhao/soft/jdk/jre/lib/sunrsasign.jar,/mnt/zhao/soft/jdk/jre/lib/jsse.jar,/mnt/zhao/soft/jdk/jre/lib/jce.jar,/mnt/zhao/soft/jdk/jre/lib/charsets.jar,/mnt/zhao/soft/jdk/jre/lib/jfr.jar,/mnt/zhao/soft/jdk/jre/classes,/mnt/zhao/soft/jdk/jre/lib/ext/dnsns.jar,/mnt/zhao/soft/jdk/jre/lib/ext/sunpkcs11.jar,/mnt/zhao/soft/jdk/jre/lib/ext/sunec.jar,/mnt/zhao/soft/jdk/jre/lib/ext/localedata.jar,/mnt/zhao/soft/jdk/jre/lib/ext/zipfs.jar,/mnt/zhao/soft/jdk/jre/lib/ext/sunjce_provider.jar,.,/mnt/zhao/soft/jdk/lib/dt.jar,/mnt/zhao/soft/jdk/lib/tools.jar]</span><br><span class="line">[loading ZipFileIndexFileObject[/mnt/zhao/soft/jdk/lib/ct.sym(META-INF/sym/rt.jar/java/lang/Object.class)]]</span><br><span class="line">[loading ZipFileIndexFileObject[/mnt/zhao/soft/jdk/lib/ct.sym(META-INF/sym/rt.jar/java/lang/String.class)]]</span><br><span class="line">[checking SumPlusTest]</span><br><span class="line">[loading ZipFileIndexFileObject[/mnt/zhao/soft/jdk/lib/ct.sym(META-INF/sym/rt.jar/java/lang/AutoCloseable.class)]]</span><br><span class="line">[loading ZipFileIndexFileObject[/mnt/zhao/soft/jdk/lib/ct.sym(META-INF/sym/rt.jar/java/lang/System.class)]]</span><br><span class="line">[loading ZipFileIndexFileObject[/mnt/zhao/soft/jdk/lib/ct.sym(META-INF/sym/rt.jar/java/io/PrintStream.class)]]</span><br><span class="line">[loading ZipFileIndexFileObject[/mnt/zhao/soft/jdk/lib/ct.sym(META-INF/sym/rt.jar/java/io/FilterOutputStream.class)]]</span><br><span class="line">[loading ZipFileIndexFileObject[/mnt/zhao/soft/jdk/lib/ct.sym(META-INF/sym/rt.jar/java/io/OutputStream.class)]]</span><br><span class="line">[loading ZipFileIndexFileObject[/mnt/zhao/soft/jdk/lib/ct.sym(META-INF/sym/rt.jar/java/lang/StringBuilder.class)]]</span><br><span class="line">[loading ZipFileIndexFileObject[/mnt/zhao/soft/jdk/lib/ct.sym(META-INF/sym/rt.jar/java/lang/CharSequence.class)]]</span><br><span class="line">[loading ZipFileIndexFileObject[/mnt/zhao/soft/jdk/lib/ct.sym(META-INF/sym/rt.jar/java/io/Serializable.class)]]</span><br><span class="line">[loading ZipFileIndexFileObject[/mnt/zhao/soft/jdk/lib/ct.sym(META-INF/sym/rt.jar/java/lang/Comparable.class)]]</span><br><span class="line">[loading ZipFileIndexFileObject[/mnt/zhao/soft/jdk/lib/ct.sym(META-INF/sym/rt.jar/java/lang/AbstractStringBuilder.class)]]</span><br><span class="line">[loading ZipFileIndexFileObject[/mnt/zhao/soft/jdk/lib/ct.sym(META-INF/sym/rt.jar/java/lang/StringBuffer.class)]]</span><br><span class="line">[wrote RegularFileObject[./classdir/SumPlusTest.class]]</span><br><span class="line">[total 639ms]</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">### -d参数</span><br><span class="line"></span><br><span class="line">设置类文件的目标目录。如果某个类是一个包的组成部分，则 javac 将把该类文件放入反映包名的子目录中，必要时创建目录。例如，如果指定 `-d ./HelloWorldDir` 并且该类名叫 `com.zhao.test`，那么类文件就叫作 `./HelloWorldDir/package com.zhao.test.HelloWorld.class`。</span><br><span class="line"></span><br><span class="line">若未指定 -d 选项，则 javac 将把类文件放到与源文件相同的目录中。</span><br><span class="line"></span><br><span class="line">注意： -d 选项指定的目录不会被自动添加到用户类路径中。</span><br></pre></td></tr></table></figure>
<p>[root@z1 java]# cat HelloWorld.java<br>package com.zhao.test;</p>
<p>public class HelloWorld {<br>    public static void main(String[] args){<br>        System.out.println(“Helloworld!”);<br>    }<br>}</p>
<p>[root@z1 java]# javac -d HelloWorldDir/ HelloWorld.java </p>
<p>[root@z1 java]# tree HelloWorldDir/<br>HelloWorldDir/<br>└── com<br>    └── zhao<br>        └── test<br>            └── HelloWorld.class</p>
<p>3 directories, 1 file<br>[root@z1 java]#<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># javap</span><br><span class="line"></span><br><span class="line">## 简介</span><br><span class="line"></span><br><span class="line">javap，是JDK自带的反汇编工具，用于将Java字节码文件反汇编为Java源代码。</span><br><span class="line"></span><br><span class="line">具体到我所能用的功能来说，就是Java编译器为我们生成的字节码。特别是在针对一些比较细节的问题，比如java的中间缓存变量机制或者String的一些问题时，通过javap来来分析，会直观的多</span><br><span class="line"></span><br><span class="line">## 常用参数</span><br><span class="line"></span><br><span class="line">下面介绍几个常用或者说自己会用的参数。</span><br></pre></td></tr></table></figure></p>
<p>用法: javap <options> <classes><br>可能的选项包括:<br>  -help  –help  -?        打印用法信息<br>  -version                 版本信息<br>  -v  -verbose             打印附加信息<br>  -l                       打印行号和本地变量表<br>  -public                  仅显示public类和成员<br>  -protected               显示protected/public类和成员<br>  -package                 显示package/protected/public类和成员(默认值)<br>  -p  -private             显示所有的类和成员<br>  -c                       反汇编代码<br>  -s                       打印内部类型签名<br>  -sysinfo                 显示将被处理的类的系统信息(路径，大小，日期，MD5 哈希值)<br>  -constants               显示static final常量<br>  -classpath <path></path>        指定查找用户类文件的位置<br>  -bootclasspath <path></path>    覆盖由引导类加载器所加载的类文件的位置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">## 例子</span><br><span class="line"></span><br><span class="line">### 无参数</span><br><span class="line"></span><br><span class="line">没什么太多的信息</span><br></pre></td></tr></table></figure></classes></options></p>
<p>[root@z1 classdir]# javap SumPlusTest<br>public class SumPlusTest {<br>  public SumPlusTest();<br>  public static void main(java.lang.String[]);<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### -c参数</span><br><span class="line"></span><br><span class="line">反汇编字节码文件为JVM可以识别、执行的字节码命令</span><br></pre></td></tr></table></figure></p>
<p>[root@z1 classdir]# javap -c SumPlusTest<br>public class SumPlusTest {<br>  public SumPlusTest();<br>    Code:<br>       0: aload_0<br>       1: invokespecial #1                  // Method java/lang/Object.”<init>“:()V<br>       4: return        </init></p>
<p>  public static void main(java.lang.String[]);<br>    Code:<br>       0: iconst_1<br>       1: istore_1<br>       2: iconst_1<br>       3: istore_2<br>       4: iconst_1<br>       5: istore_3<br>       6: iconst_1<br>       7: istore        4<br>       9: iinc          1, 1<br>      12: iinc          2, 1<br>      15: iload_3<br>      16: iinc          3, 1<br>      19: istore_3<br>      20: iinc          4, 1<br>      23: iload         4<br>      25: istore        4<br>      27: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;<br>      30: new           #3                  // class java/lang/StringBuilder<br>      33: dup<br>      34: invokespecial #4                  // Method java/lang/StringBuilder.”<init>“:()V<br>      37: ldc           #5                  // String a :<br>      39: invokevirtual #6                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;<br>      42: iload_1<br>      43: invokevirtual #7                  // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;<br>      46: ldc           #8                  // String \nb :<br>      48: invokevirtual #6                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;<br>      51: iload_2<br>      52: invokevirtual #7                  // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;<br>      55: ldc           #9                  // String \nc :<br>      57: invokevirtual #6                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;<br>      60: iload_3<br>      61: invokevirtual #7                  // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;<br>      64: ldc           #10                 // String \nd :<br>      66: invokevirtual #6                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;<br>      69: iload         4<br>      71: invokevirtual #7                  // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;<br>      74: invokevirtual #11                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;<br>      77: invokevirtual #12                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V<br>      80: return<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### -verbose参数</span><br><span class="line"></span><br><span class="line">-verbose打印方法参数、常量池、栈区等各种信息。</span><br><span class="line"></span><br><span class="line">具体内容，放在i++相关的中间缓存变量机制中说明。</span><br></pre></td></tr></table></figure></init></p>
<p>[root@z1 classdir]# javap -verbose SumPlusTest<br>Classfile /mnt/workspace/java/i++issue/classdir/SumPlusTest.class<br>  Last modified Sep 3, 2015; size 794 bytes<br>  MD5 checksum 3a406dc81fe69722d53ce74ef96516a4<br>public class SumPlusTest<br>  minor version: 0<br>  major version: 51<br>  flags: ACC_PUBLIC, ACC_SUPER<br>Constant pool:</p>
<p>   #1 = Methodref          #14.#30        //  java/lang/Object.”<init>“:()V</init></p>
<p>   #2 = Fieldref           #31.#32        //  java/lang/System.out:Ljava/io/PrintStream;</p>
<p>   #3 = Class              #33            //  java/lang/StringBuilder</p>
<p>   #4 = Methodref          #3.#30         //  java/lang/StringBuilder.”<init>“:()V</init></p>
<p>   #5 = String             #34            //  a : </p>
<p>   #6 = Methodref          #3.#35         //  java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</p>
<p>   #7 = Methodref          #3.#36         //  java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;</p>
<p>   #8 = String             #37            //  \nb : </p>
<p>   #9 = String             #38            //  \nc : </p>
<p>  #10 = String             #39            //  \nd : </p>
<p>  #11 = Methodref          #3.#40         //  java/lang/StringBuilder.toString:()Ljava/lang/String;</p>
<p>  #12 = Methodref          #41.#42        //  java/io/PrintStream.println:(Ljava/lang/String;)V</p>
<p>  #13 = Class              #43            //  SumPlusTest</p>
<p>  #14 = Class              #44            //  java/lang/Object</p>
<p>  #15 = Utf8               <init></init></p>
<p>  #16 = Utf8               ()V</p>
<p>  #17 = Utf8               Code</p>
<p>  #18 = Utf8               LocalVariableTable</p>
<p>  #19 = Utf8               this</p>
<p>  #20 = Utf8               LSumPlusTest;</p>
<p>  #21 = Utf8               main</p>
<p>  #22 = Utf8               ([Ljava/lang/String;)V</p>
<p>  #23 = Utf8               args</p>
<p>  #24 = Utf8               [Ljava/lang/String;</p>
<p>  #25 = Utf8               a</p>
<p>  #26 = Utf8               I</p>
<p>  #27 = Utf8               b</p>
<p>  #28 = Utf8               c</p>
<p>  #29 = Utf8               d</p>
<p>  #30 = NameAndType        #15:#16        //  “<init>“:()V</init></p>
<p>  #31 = Class              #45            //  java/lang/System</p>
<p>  #32 = NameAndType        #46:#47        //  out:Ljava/io/PrintStream;</p>
<p>  #33 = Utf8               java/lang/StringBuilder</p>
<p>  #34 = Utf8               a : </p>
<p>  #35 = NameAndType        #48:#49        //  append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</p>
<p>  #36 = NameAndType        #48:#50        //  append:(I)Ljava/lang/StringBuilder;</p>
<p>  #37 = Utf8               \nb : </p>
<p>  #38 = Utf8               \nc : </p>
<p>  #39 = Utf8               \nd : </p>
<p>  #40 = NameAndType        #51:#52        //  toString:()Ljava/lang/String;</p>
<p>  #41 = Class              #53            //  java/io/PrintStream</p>
<p>  #42 = NameAndType        #54:#55        //  println:(Ljava/lang/String;)V</p>
<p>  #43 = Utf8               SumPlusTest</p>
<p>  #44 = Utf8               java/lang/Object</p>
<p>  #45 = Utf8               java/lang/System</p>
<p>  #46 = Utf8               out</p>
<p>  #47 = Utf8               Ljava/io/PrintStream;</p>
<p>  #48 = Utf8               append</p>
<p>  #49 = Utf8               (Ljava/lang/String;)Ljava/lang/StringBuilder;</p>
<p>  #50 = Utf8               (I)Ljava/lang/StringBuilder;</p>
<p>  #51 = Utf8               toString</p>
<p>  #52 = Utf8               ()Ljava/lang/String;</p>
<p>  #53 = Utf8               java/io/PrintStream</p>
<p>  #54 = Utf8               println</p>
<p>  #55 = Utf8               (Ljava/lang/String;)V<br>{<br>  public SumPlusTest();<br>    flags: ACC_PUBLIC<br>    Code:<br>      stack=1, locals=1, args_size=1<br>         0: aload_0<br>         1: invokespecial #1                  // Method java/lang/Object.”<init>“:()V<br>         4: return<br>      LocalVariableTable:<br>        Start  Length  Slot  Name   Signature<br>               0       5     0  this   LSumPlusTest;</init></p>
<p>  public static void main(java.lang.String[]);<br>    flags: ACC_PUBLIC, ACC_STATIC<br>    Code:<br>      stack=3, locals=5, args_size=1<br>         0: iconst_1<br>         1: istore_1<br>         2: iconst_1<br>         3: istore_2<br>         4: iconst_1<br>         5: istore_3<br>         6: iconst_1<br>         7: istore        4<br>         9: iinc          1, 1<br>        12: iinc          2, 1<br>        15: iload_3<br>        16: iinc          3, 1<br>        19: istore_3<br>        20: iinc          4, 1<br>        23: iload         4<br>        25: istore        4<br>        27: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;<br>        30: new           #3                  // class java/lang/StringBuilder<br>        33: dup<br>        34: invokespecial #4                  // Method java/lang/StringBuilder.”<init>“:()V<br>        37: ldc           #5                  // String a :<br>        39: invokevirtual #6                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;<br>        42: iload_1<br>        43: invokevirtual #7                  // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;<br>        46: ldc           #8                  // String \nb :<br>        48: invokevirtual #6                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;<br>        51: iload_2<br>        52: invokevirtual #7                  // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;<br>        55: ldc           #9                  // String \nc :<br>        57: invokevirtual #6                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;<br>        60: iload_3<br>        61: invokevirtual #7                  // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;<br>        64: ldc           #10                 // String \nd :<br>        66: invokevirtual #6                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;<br>        69: iload         4<br>        71: invokevirtual #7                  // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;<br>        74: invokevirtual #11                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;<br>        77: invokevirtual #12                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V<br>        80: return<br>      LocalVariableTable:<br>        Start  Length  Slot  Name   Signature<br>               0      81     0  args   [Ljava/lang/String;<br>               2      79     1     a   I<br>               4      77     2     b   I<br>               6      75     3     c   I<br>               9      72     4     d   I<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># jhat</span><br><span class="line">## 简介</span><br><span class="line"></span><br><span class="line">### 说明</span><br><span class="line"></span><br><span class="line">用于对JAVA heap进行离线分析的工具，他可以对不同虚拟机中导出的heap信息文件进行分析，如LINUX上导出的文件可以拿到WINDOWS上进行分析，可以查找诸如内存方面的问题。</span><br><span class="line"></span><br><span class="line">### 使用</span><br><span class="line"></span><br><span class="line">jhat结合jmap使用，有网页的界面可以查看。</span><br></pre></td></tr></table></figure></init></p>
<p>[root@z1 week1]# jhat -help<br>Usage:  jhat [-stack <bool>] [-refs <bool>] [-port <port>] [-baseline <file>] [-debug <int>] [-version] [-h|-help] <file></file></int></file></port></bool></bool></p>
<pre><code>-J&lt;flag&gt;          Pass &lt;flag&gt; directly to the runtime system. For
          example, -J-mx512m to use a maximum heap size of 512MB
-stack false:     Turn off tracking object allocation call stack.
-refs false:      Turn off tracking of references to objects
-port &lt;port&gt;:     Set the port for the HTTP server.  Defaults to 7000
-exclude &lt;file&gt;:  Specify a file that lists data members that should
          be excluded from the reachableFrom query.
-baseline &lt;file&gt;: Specify a baseline object dump.  Objects in
          both heap dumps with the same ID and same class will
          be marked as not being &quot;new&quot;.
-debug &lt;int&gt;:     Set debug level.
            0:  No debug output
            1:  Debug hprof file parsing
            2:  Debug hprof file parsing, no server
-version          Report version number
-h|-help          Print this help and exit
&lt;file&gt;            The file to read
</code></pre><p>For a dump file that contains multiple heap dumps,<br>you may specify which dump in the file<br>by appending “#<number>“ to the file name, i.e. “foo.hprof#3”.</number></p>
<p>All boolean options default to “true”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 例子</span><br><span class="line"></span><br><span class="line">运行下面的指令后，可以在浏览器中打开相应的端口查看。</span><br></pre></td></tr></table></figure></p>
<p>[root@z1 week1]# jhat -J-Xmx4g jmaptest.dat<br>Reading from jmaptest.dat…<br>Dump file created Wed Oct 21 15:42:36 CST 2015<br>Snapshot read, resolving…<br>Resolving 1915686 objects…<br>Chasing references, expect 383 dots…………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………..<br>Eliminating duplicate references…………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………………..<br>Snapshot resolved.<br>Started HTTP server on port 7000<br>Server is ready.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># jmap</span><br><span class="line"></span><br><span class="line">## 简介</span><br><span class="line"></span><br><span class="line">### 说明</span><br><span class="line"></span><br><span class="line">打印出某个java进程（使用pid）内存内的所有‘对象’的情况（如：产生那些对象，及其数量）</span><br><span class="line"></span><br><span class="line">### 使用</span><br><span class="line"></span><br><span class="line">常用的指令如：`jmap -heap pid`和 `jmap -dump:live,format=b,file=jmaptest.dat 1535`。</span><br><span class="line"></span><br><span class="line">前者查看内存的信息，后者导出镜像文件，可以结合jhat使用分析。</span><br></pre></td></tr></table></figure></p>
<p>[root@z1 week1]# jmap<br>Usage:<br>    jmap [option] <pid><br>        (to connect to running process)<br>    jmap [option] <executable <core=""><br>        (to connect to a core file)<br>    jmap [option] [server_id@]<remote server="" ip="" or="" hostname=""><br>        (to connect to remote debug server)</remote></executable></pid></p>
<p>where <option> is one of:<br>    <none>               to print same info as Solaris pmap<br>    -heap                to print java heap summary<br>    -histo[:live]        to print histogram of java object heap; if the “live”<br>                         suboption is specified, only count live objects<br>    -permstat            to print permanent generation statistics<br>    -finalizerinfo       to print information on objects awaiting finalization<br>    -dump:<dump-options> to dump java heap in hprof binary format<br>                         dump-options:<br>                           live         dump only live objects; if not specified,<br>                                        all objects in the heap are dumped.<br>                           format=b     binary format<br>                           file=<file>  dump heap to <file><br>                         Example: jmap -dump:live,format=b,file=heap.bin <pid><br>    -F                   force. Use with -dump:<dump-options> <pid> or -histo<br>                         to force a heap dump or histogram when <pid> does not<br>                         respond. The “live” suboption is not supported<br>                         in this mode.<br>    -h | -help           to print this help message<br>    -J<flag>             to pass <flag> directly to the runtime system<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 例子</span><br></pre></td></tr></table></figure></flag></flag></pid></pid></dump-options></pid></file></file></dump-options></none></option></p>
<p>[root@z1 week1]# jmap -dump:live,format=b,file=jmaptest.dat 1535<br>Dumping heap to /mnt/zhao/workspace/jmaptest.dat …<br>Heap dump file created<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>[root@z1 week1]# jmap -heap 1535<br>Attaching to process ID 1535, please wait…<br>Debugger attached successfully.<br>Server compiler detected.<br>JVM version is 24.79-b02</p>
<p>using thread-local object allocation.<br>Mark Sweep Compact GC</p>
<p>Heap Configuration:<br>   MinHeapFreeRatio = 40<br>   MaxHeapFreeRatio = 70<br>   MaxHeapSize      = 492830720 (470.0MB)<br>   NewSize          = 1310720 (1.25MB)<br>   MaxNewSize       = 17592186044415 MB<br>   OldSize          = 5439488 (5.1875MB)<br>   NewRatio         = 2<br>   SurvivorRatio    = 8<br>   PermSize         = 21757952 (20.75MB)<br>   MaxPermSize      = 85983232 (82.0MB)<br>   G1HeapRegionSize = 0 (0.0MB)</p>
<p>Heap Usage:<br>New Generation (Eden + 1 Survivor Space):<br>   capacity = 9240576 (8.8125MB)<br>   used     = 7314720 (6.975860595703125MB)<br>   free     = 1925856 (1.836639404296875MB)<br>   79.15870179521276% used<br>Eden Space:<br>   capacity = 8257536 (7.875MB)<br>   used     = 6331680 (6.038360595703125MB)<br>   free     = 1925856 (1.836639404296875MB)<br>   76.67759486607143% used<br>From Space:<br>   capacity = 983040 (0.9375MB)<br>   used     = 983040 (0.9375MB)<br>   free     = 0 (0.0MB)<br>   100.0% used<br>To Space:<br>   capacity = 983040 (0.9375MB)<br>   used     = 0 (0.0MB)<br>   free     = 983040 (0.9375MB)<br>   0.0% used<br>tenured generation:<br>   capacity = 20512768 (19.5625MB)<br>   used     = 2652424 (2.5295486450195312MB)<br>   free     = 17860344 (17.03295135498047MB)<br>   12.930600102336262% used<br>Perm Generation:<br>   capacity = 21757952 (20.75MB)<br>   used     = 2514048 (2.3975830078125MB)<br>   free     = 19243904 (18.3524169921875MB)<br>   11.554616905120483% used</p>
<p>737 interned Strings occupying 48224 bytes.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># jstack</span><br><span class="line"></span><br><span class="line">## 简介</span><br><span class="line"></span><br><span class="line">### 功能</span><br><span class="line"></span><br><span class="line">jstack命令主要用于输出线程信息。</span><br><span class="line"></span><br><span class="line">我们主要是看线程状态，在jstack中是可以得到遍历的。通常使用jstack -l &lt;pid&gt; 命令，如果未输出线程信息，则可以尝试使用-F参数强制输出。</span><br><span class="line"></span><br><span class="line">### 使用方法</span><br></pre></td></tr></table></figure></p>
<p>[root@z1 week1]# jstack<br>Usage:<br>    jstack [-l] <pid><br>        (to connect to running process)<br>    jstack -F [-m] [-l] <pid><br>        (to connect to a hung process)<br>    jstack [-m] [-l] <executable> <core><br>        (to connect to a core file)<br>    jstack [-m] [-l] [server_id@]<remote server="" ip="" or="" hostname=""><br>        (to connect to a remote debug server)</remote></core></executable></pid></pid></p>
<p>Options:<br>    -F  to force a thread dump. Use when jstack <pid> does not respond (process is hung)<br>    -m  to print both java and native frames (mixed mode)<br>    -l  long listing. Prints additional information about locks<br>    -h or -help to print this help message<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">## 例子</span><br><span class="line"></span><br><span class="line">写一个死锁的例子，通过jstack查看线程的信息。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 程序</span><br><span class="line"></span><br><span class="line">网上随便找了一个小的死锁例子。</span><br><span class="line"></span><br><span class="line">程序中MyThread1和MyThread2都申请了两个Resource，他们之间存在一个死锁的情况。</span><br></pre></td></tr></table></figure></pid></p>
<p>public class DeadLock {<br>    public static void main(String[] args) {<br>        Resource r1= new Resource();<br>        Resource r2= new Resource();<br>        //每个线程都拥有r1,r2两个对象<br>        Thread myTh1 = new MyThread1(r1,r2);<br>        Thread myTh2 = new MyThread2(r1,r2);<br>        myTh1.start();<br>        myTh2.start();<br>    }<br>}  </p>
<p>class Resource{<br>    private int i;<br>}  </p>
<p>class MyThread1 extends Thread{<br>    private Resource r1,r2;<br>    public MyThread1(Resource r1, Resource r2) {<br>        this.r1 = r1;<br>        this.r2 = r2;<br>    }  </p>
<pre><code>@Override  
public void run() {  
    while(true){  
    //先获得r1的锁，再获得r2的锁     
    synchronized (r1) {  
        System.out.println(&quot;1号线程获取了r1的锁&quot;);  
        synchronized (r2) {  
            System.out.println(&quot;1号线程获取了r2的锁&quot;);  
        }  
    }  
    }  
}  
</code></pre><p>}  </p>
<p>class MyThread2 extends Thread{<br>    private Resource r1,r2;<br>    public MyThread2(Resource r1, Resource r2) {<br>        this.r1 = r1;<br>        this.r2 = r2;<br>    }  </p>
<pre><code>@Override  
public void run() {
    while(true){  
    //先获得r2的锁，再获得r1的锁  
    synchronized (r2) {  
        System.out.println(&quot;2号线程获取了r2的锁&quot;);  
        synchronized (r1) {  
            System.out.println(&quot;2号线程获取了r1的锁&quot;);  
        }  
    }  
    }  
}  
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 输出结果</span><br><span class="line"></span><br><span class="line">可以看到，两个线程在获取资源的时候发生了死锁。</span><br></pre></td></tr></table></figure></p>
<p>1号线程获取了r1的锁<br>2号线程获取了r2的锁<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 线程信息</span><br><span class="line"></span><br><span class="line">信息中有很多是java自己的进程，每个进程的状态也有显示。</span><br><span class="line"></span><br><span class="line">在信息最后面的部分，可以看到MyThread1和MyThread2发生死锁的具体情况。</span><br></pre></td></tr></table></figure></p>
<p>[root@z1 week1]# jstack -l 1382<br>2015-10-21 15:14:29<br>Full thread dump Java HotSpot(TM) 64-Bit Server VM (24.79-b02 mixed mode):</p>
<p>“Attach Listener” daemon prio=10 tid=0x00007f72bc001000 nid=0x5ad waiting on condition [0x0000000000000000]<br>   java.lang.Thread.State: RUNNABLE</p>
<p>   Locked ownable synchronizers:</p>
<pre><code>- None
</code></pre><p>“DestroyJavaVM” prio=10 tid=0x00007f72e0008800 nid=0x567 waiting on condition [0x0000000000000000]<br>   java.lang.Thread.State: RUNNABLE</p>
<p>   Locked ownable synchronizers:</p>
<pre><code>- None
</code></pre><p>“Thread-1” prio=10 tid=0x00007f72e00a8000 nid=0x571 waiting for monitor entry [0x00007f72d78f7000]<br>   java.lang.Thread.State: BLOCKED (on object monitor)<br>    at MyThread2.run(DeadLock.java:53)</p>
<pre><code>- waiting to lock &lt;0x00000000dd84e7e0&gt; (a Resource)
- locked &lt;0x00000000dd84e7f0&gt; (a Resource)
</code></pre><p>   Locked ownable synchronizers:</p>
<pre><code>- None
</code></pre><p>“Thread-0” prio=10 tid=0x00007f72e00a6000 nid=0x570 waiting for monitor entry [0x00007f72d79f8000]<br>   java.lang.Thread.State: BLOCKED (on object monitor)<br>    at MyThread1.run(DeadLock.java:31)</p>
<pre><code>- waiting to lock &lt;0x00000000dd84e7f0&gt; (a Resource)
- locked &lt;0x00000000dd84e7e0&gt; (a Resource)
</code></pre><p>   Locked ownable synchronizers:</p>
<pre><code>- None
</code></pre><p>“Service Thread” daemon prio=10 tid=0x00007f72e008c800 nid=0x56e runnable [0x0000000000000000]<br>   java.lang.Thread.State: RUNNABLE</p>
<p>   Locked ownable synchronizers:</p>
<pre><code>- None
</code></pre><p>“C2 CompilerThread1” daemon prio=10 tid=0x00007f72e008a000 nid=0x56d waiting on condition [0x0000000000000000]<br>   java.lang.Thread.State: RUNNABLE</p>
<p>   Locked ownable synchronizers:</p>
<pre><code>- None
</code></pre><p>“C2 CompilerThread0” daemon prio=10 tid=0x00007f72e0087800 nid=0x56c waiting on condition [0x0000000000000000]<br>   java.lang.Thread.State: RUNNABLE</p>
<p>   Locked ownable synchronizers:</p>
<pre><code>- None
</code></pre><p>“Signal Dispatcher” daemon prio=10 tid=0x00007f72e0085800 nid=0x56b runnable [0x0000000000000000]<br>   java.lang.Thread.State: RUNNABLE</p>
<p>   Locked ownable synchronizers:</p>
<pre><code>- None
</code></pre><p>“Finalizer” daemon prio=10 tid=0x00007f72e0064800 nid=0x56a in Object.wait() [0x00007f72d7ffe000]<br>   java.lang.Thread.State: WAITING (on object monitor)<br>    at java.lang.Object.wait(Native Method)</p>
<pre><code>- waiting on &lt;0x00000000dd804858&gt; (a java.lang.ref.ReferenceQueue$Lock)
at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:135)
- locked &lt;0x00000000dd804858&gt; (a java.lang.ref.ReferenceQueue$Lock)
at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:151)
at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)
</code></pre><p>   Locked ownable synchronizers:</p>
<pre><code>- None
</code></pre><p>“Reference Handler” daemon prio=10 tid=0x00007f72e0062800 nid=0x569 in Object.wait() [0x00007f72dc14d000]<br>   java.lang.Thread.State: WAITING (on object monitor)<br>    at java.lang.Object.wait(Native Method)</p>
<pre><code>- waiting on &lt;0x00000000dd804470&gt; (a java.lang.ref.Reference$Lock)
at java.lang.Object.wait(Object.java:503)
at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:133)
- locked &lt;0x00000000dd804470&gt; (a java.lang.ref.Reference$Lock)
</code></pre><p>   Locked ownable synchronizers:</p>
<pre><code>- None
</code></pre><p>“VM Thread” prio=10 tid=0x00007f72e005e800 nid=0x568 runnable </p>
<p>“VM Periodic Task Thread” prio=10 tid=0x00007f72e0097800 nid=0x56f waiting on condition </p>
<p>JNI global references: 107</p>
<h1 id="Found-one-Java-level-deadlock"><a href="#Found-one-Java-level-deadlock" class="headerlink" title="Found one Java-level deadlock:"></a>Found one Java-level deadlock:</h1><p>“Thread-1”:<br>  waiting to lock monitor 0x00007f72d0003828 (object 0x00000000dd84e7e0, a Resource),<br>  which is held by “Thread-0”<br>“Thread-0”:<br>  waiting to lock monitor 0x00007f72d00062c8 (object 0x00000000dd84e7f0, a Resource),<br>  which is held by “Thread-1”</p>
<h1 id="Java-stack-information-for-the-threads-listed-above"><a href="#Java-stack-information-for-the-threads-listed-above" class="headerlink" title="Java stack information for the threads listed above:"></a>Java stack information for the threads listed above:</h1><p>“Thread-1”:<br>    at MyThread2.run(DeadLock.java:53)</p>
<pre><code>- waiting to lock &lt;0x00000000dd84e7e0&gt; (a Resource)
- locked &lt;0x00000000dd84e7f0&gt; (a Resource)
</code></pre><p>“Thread-0”:<br>    at MyThread1.run(DeadLock.java:31)</p>
<pre><code>- waiting to lock &lt;0x00000000dd84e7f0&gt; (a Resource)
- locked &lt;0x00000000dd84e7e0&gt; (a Resource)
</code></pre><p>Found 1 deadlock.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># jstat</span><br><span class="line"></span><br><span class="line">## 简介</span><br><span class="line"></span><br><span class="line">### 功能</span><br><span class="line"></span><br><span class="line">一个极强的监视VM内存工具，可以用来监视VM内存内的各种堆和非堆的大小及其内存使用量。</span><br><span class="line"></span><br><span class="line">jstat是JDK自带的一个轻量级小工具。全称“Java Virtual Machine statistics monitoring tool”。</span><br><span class="line"></span><br><span class="line">它位于java的bin目录下，主要利用JVM内建的指令对Java应用程序的资源和性能进行实时的命令行的监控，包括了对Heap size和垃圾回收状况的监控。</span><br><span class="line"></span><br><span class="line">### 使用方法</span><br><span class="line"></span><br><span class="line">jstat比较常用的使用方法：`jstat -gcutil $&#123;PID&#125; 2000`，这条指令的意思是，每隔2000的时间间隔统计GC的信息。</span><br><span class="line"></span><br><span class="line">相信的使用方法如下：</span><br></pre></td></tr></table></figure></p>
<p>[root@z1 ~]# jstat -help<br>Usage: jstat -help|-options<br>       jstat -<option> [-t] [-h<lines>] <vmid> [<interval> [<count>]]</count></interval></vmid></lines></option></p>
<p>Definitions:<br>  <option>      An option reported by the -options option<br>  <vmid>        Virtual Machine Identifier. A vmid takes the following form:<br>                     <lvmid>[@<hostname>[:<port>]]<br>                Where <lvmid> is the local vm identifier for the target<br>                Java virtual machine, typically a process id; <hostname> is<br>                the name of the host running the target Java virtual machine;<br>                and <port> is the port number for the rmiregistry on the<br>                target host. See the jvmstat documentation for a more complete<br>                description of the Virtual Machine Identifier.<br>  <lines>       Number of samples between header lines.<br>  <interval>    Sampling interval. The following forms are allowed:<br>                    <n>[“ms”|”s”]<br>                Where <n> is an integer and the suffix specifies the units as<br>                milliseconds(“ms”) or seconds(“s”). The default units are “ms”.<br>  <count>       Number of samples to take before terminating.<br>  -J<flag>      Pass <flag> directly to the runtime system.</flag></flag></count></n></n></interval></lines></port></hostname></lvmid></port></hostname></lvmid></vmid></option></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">jstat有很多可选的option，使用方法同上。</span><br></pre></td></tr></table></figure>
<p>-class<br>-compiler<br>-gc<br>-gccapacity<br>-gccause<br>-gcnew<br>-gcnewcapacity<br>-gcold<br>-gcoldcapacity<br>-gcpermcapacity<br>-gcutil<br>-printcompilation<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 参数介绍</span><br><span class="line"></span><br><span class="line">常用的参数含义如下</span><br><span class="line"></span><br><span class="line">- S0：年轻代中第一个survivor（幸存区）已使用的占当前容量百分比</span><br><span class="line">- S1：年轻代中第二个survivor（幸存区）已使用的占当前容量百分比</span><br><span class="line">- E：年轻代中Eden（伊甸园）已使用的占当前容量百分比</span><br><span class="line">- O：old代已使用的占当前容量百分比</span><br><span class="line">- P：perm代已使用的占当前容量百分比</span><br><span class="line">- YGC：从应用程序启动到采样时年轻代中gc次数</span><br><span class="line">- YGCT：从应用程序启动到采样时年轻代中gc所用时间(s)</span><br><span class="line">- FGC：从应用程序启动到采样时old代(全gc)gc次数</span><br><span class="line">- FGCT：从应用程序启动到采样时old代(全gc)gc所用时间(s)</span><br><span class="line">- GCT：从应用程序启动到采样时gc用的总时间(s)</span><br><span class="line"></span><br><span class="line">## 例子</span><br></pre></td></tr></table></figure></p>
<p>[root@z1 ~]# jstat -gcutil 872 2000<br>  S0     S1     E      O      P     YGC     YGCT    FGC    FGCT     GCT<br> 22.60   0.00  95.94   0.00  11.42      2    0.003     0    0.000    0.003<br> 22.60   0.00  95.94   0.00  11.42      2    0.003     0    0.000    0.003<br> 22.60   0.00  95.94   0.00  11.42      2    0.003     0    0.000    0.003<br> 22.60   0.00  97.94   0.00  11.42      2    0.003     0    0.000    0.003<br> 22.60   0.00  97.94   0.00  11.42      2    0.003     0    0.000    0.003<br> 22.60   0.00  97.94   0.00  11.42      2    0.003     0    0.000    0.003<br> 22.60   0.00  97.94   0.00  11.42      2    0.003     0    0.000    0.003<br> 22.60   0.00  99.94   0.00  11.42      2    0.003     0    0.000    0.003<br> 22.60   0.00  99.94   0.00  11.42      2    0.003     0    0.000    0.003<br> 22.60   0.00  99.94   0.00  11.42      2    0.003     0    0.000    0.003<br> 22.60   0.00  99.94   0.00  11.42      2    0.003     0    0.000    0.003<br>  0.00  21.78   2.02   0.00  11.42      3    0.005     0    0.000    0.005<br>  0.00  21.78   2.02   0.00  11.42      3    0.005     0    0.000    0.005<br>  0.00  21.78   2.02   0.00  11.42      3    0.005     0    0.000    0.005<br>  0.00  21.78   2.02   0.00  11.42      3    0.005     0    0.000    0.005<br>  0.00  21.78   4.04   0.00  11.42      3    0.005     0    0.000    0.005<br>  0.00  21.78   4.04   0.00  11.42      3    0.005     0    0.000    0.005<br>  0.00  21.78   4.04   0.00  11.42      3    0.005     0    0.000    0.005<br>  0.00  21.78   4.04   0.00  11.42      3    0.005     0    0.000    0.005<br>  0.00  21.78   6.05   0.00  11.42      3    0.005     0    0.000    0.005<br>  0.00  21.78   6.05   0.00  11.42      3    0.005     0    0.000    0.005<br>  0.00  21.78   6.05   0.00  11.42      3    0.005     0    0.000    0.005<br>  0.00  21.78   6.05   0.00  11.42      3    0.005     0    0.000    0.005<br>  0.00  21.78   8.06   0.00  11.42      3    0.005     0    0.000    0.005<br>```</p>
</div><a data-url="http://zhaodedong.github.iohttp:/zhaodedong.github.io/2015/09/01/java-tools.html" data-id="cilkeuxug000be4w5wgr5rg5k" class="article-share-link">分享到</a><div class="tags"><a href="http:/zhaodedong.github.io/tags/java/">java</a><a href="http:/zhaodedong.github.io/tags/tools/">tools</a></div><div class="post-nav"><a href="http:/zhaodedong.github.io/2015/09/04/java-i-plusplus.html" class="pre">Java：i++问题（详细分析）</a><a href="http:/zhaodedong.github.io/2015/08/14/linux-partition-fdisk-parted.html" class="next">Linux：磁盘分区和挂载（parted和fdisk两种方式详细说明）</a></div><div data-thread-key="2015/09/01/java-tools.html" data-title="Java工具：javac、javap、jmap、jhat、jstack、jstat" data-url="http://zhaodedong.github.iohttp:/zhaodedong.github.io/2015/09/01/java-tools.html" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2015/09/01/java-tools.html" data-title="Java工具：javac、javap、jmap、jhat、jstack、jstat" data-url="http://zhaodedong.github.iohttp:/zhaodedong.github.io/2015/09/01/java-tools.html" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://zhaodedong.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="http:/zhaodedong.github.io/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="http:/zhaodedong.github.io/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="http:/zhaodedong.github.io/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="http:/zhaodedong.github.io/categories/meeting/">meeting</a></li><li class="category-list-item"><a class="category-list-link" href="http:/zhaodedong.github.io/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="http:/zhaodedong.github.io/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="http:/zhaodedong.github.io/categories/shell/">shell</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="http:/zhaodedong.github.io/tags/disk/" style="font-size: 15px;">disk</a> <a href="http:/zhaodedong.github.io/tags/java/" style="font-size: 15px;">java</a> <a href="http:/zhaodedong.github.io/tags/docker/" style="font-size: 15px;">docker</a> <a href="http:/zhaodedong.github.io/tags/string/" style="font-size: 15px;">string</a> <a href="http:/zhaodedong.github.io/tags/tools/" style="font-size: 15px;">tools</a> <a href="http:/zhaodedong.github.io/tags/linux/" style="font-size: 15px;">linux</a> <a href="http:/zhaodedong.github.io/tags/cluster/" style="font-size: 15px;">cluster</a> <a href="http:/zhaodedong.github.io/tags/shell/" style="font-size: 15px;">shell</a> <a href="http:/zhaodedong.github.io/tags/vm/" style="font-size: 15px;">vm</a> <a href="http:/zhaodedong.github.io/tags/i/" style="font-size: 15px;">i++</a> <a href="http:/zhaodedong.github.io/tags/ext/" style="font-size: 15px;">ext</a> <a href="http:/zhaodedong.github.io/tags/filesystem/" style="font-size: 15px;">filesystem</a> <a href="http:/zhaodedong.github.io/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="http:/zhaodedong.github.io/tags/cpu/" style="font-size: 15px;">cpu</a> <a href="http:/zhaodedong.github.io/tags/grep/" style="font-size: 15px;">grep</a> <a href="http:/zhaodedong.github.io/tags/python/" style="font-size: 15px;">python</a> <a href="http:/zhaodedong.github.io/tags/mechanize/" style="font-size: 15px;">mechanize</a> <a href="http:/zhaodedong.github.io/tags/bigdata/" style="font-size: 15px;">bigdata</a> <a href="http:/zhaodedong.github.io/tags/hadoop/" style="font-size: 15px;">hadoop</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="http:/zhaodedong.github.io/2016/01/01/mysql-error-process.html">Mysql：一次mysql错误处理</a></li><li class="post-list-item"><a class="post-list-link" href="http:/zhaodedong.github.io/2015/12/06/java-string-buffer-builder.html">Java：String、StringBuffer和StringBuilder</a></li><li class="post-list-item"><a class="post-list-link" href="http:/zhaodedong.github.io/2015/09/04/java-vm-orders.html">Java：虚拟机指令总结</a></li><li class="post-list-item"><a class="post-list-link" href="http:/zhaodedong.github.io/2015/09/04/java-i-plusplus.html">Java：i++问题（详细分析）</a></li><li class="post-list-item"><a class="post-list-link" href="http:/zhaodedong.github.io/2015/09/01/java-tools.html">Java工具：javac、javap、jmap、jhat、jstack、jstat</a></li><li class="post-list-item"><a class="post-list-link" href="http:/zhaodedong.github.io/2015/08/14/linux-partition-fdisk-parted.html">Linux：磁盘分区和挂载（parted和fdisk两种方式详细说明）</a></li><li class="post-list-item"><a class="post-list-link" href="http:/zhaodedong.github.io/2015/08/11/java-passing-primitives.html">Java：详解传值和传引用</a></li><li class="post-list-item"><a class="post-list-link" href="http:/zhaodedong.github.io/2015/08/11/linux-command-summary.html">Linux：常用命令总结</a></li><li class="post-list-item"><a class="post-list-link" href="http:/zhaodedong.github.io/2015/08/10/docker-deploy-development-environment.html">Docker：搭建开发环境（运行Eclipse等图形化界面程序）</a></li><li class="post-list-item"><a class="post-list-link" href="http:/zhaodedong.github.io/2015/06/19/docker-attempt.html">Docker：初步使用</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="http:/zhaodedong.github.io/." rel="nofollow">Zhao Dedong's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="http:/zhaodedong.github.io/js/jquery.min.js?v=0.0.0"></script><script type="text/javascript" src="http:/zhaodedong.github.io/js/totop.js?v=0.0.0"></script><script type="text/javascript" src="http:/zhaodedong.github.io/js/fancybox.pack.js?v=0.0.0"></script><script type="text/javascript" src="http:/zhaodedong.github.io/js/jquery.fancybox.js?v=0.0.0"></script><link rel="stylesheet" type="text/css" href="http:/zhaodedong.github.io/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'grass'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="http:/zhaodedong.github.io/js/share.js?v=0.0.0"></script><script type="text/javascript" src="http:/zhaodedong.github.io/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="http:/zhaodedong.github.io/js/smartresize.js?v=0.0.0"></script></div></body></html>